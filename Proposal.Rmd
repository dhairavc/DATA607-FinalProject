---
title: "DATA607 - Final Project Proposal"
author: "Mael Illien, Salma Elshahawy, Dhairav Chhatbar"
date: "11/11/2019"
output:
  html_document:
  highlight: pygments
  theme: cerulean
  toc: yes
  toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Motivation

We want to try and answer the general question: What happens when there is a spike in arrests by the NYPD?

We will start with the NYPD Arrests Data (Historic) data from NYC Open Data and conduct some exploratory data analysis to find out how arrests are distributed in general. We will explore trends like for example investigating seasonality trends or trends in particular kinds of arrest or by boroughs.

To dig into the research question further, we will include data from the Civilian Complaint Review Board. We will look at the number and types of complaints received and see if there is any link to the number of arrests by the NYPD during the period of study. 

[Optional] We will then supplement our study with sentiment analysis based on data extracted via the Twitter API. We will search for NYPD related tweets for the study period of interest (specify years) and perform sentiment analysis in order to score the tweets and match them against the number of arrests.

Overall, amongst the exploratory analysis we hope to uncover what happens when there is a spike in arrests by the NYPD and whether there is civilian discontent as expressed by complaints filed against the police force? We will provide some analysis around this by conducting the following hypothesis test:

\[H0: There\;is\;no\; change\;in \; public\; discontent \; following \; NYPD \; arrests\]
\[HA: There\; is\; a\; change\; in \; public \; discontent \; following \; NYPD \; arrests\]

## Datasets
Our analysis will be around 2 datasets.

### NYPD Arrests 
List of every arrest in NYC going back to 2006. Each record represents an arrest effected in NYC by the NYPD and includes information about the type of crime, suspect demographic, the location and time of enforcement.

[NYPD Arrests Data Historic](https://data.cityofnewyork.us/Public-Safety/NYPD-Arrests-Data-Historic-/8h9b-rp9u)  

#### Dataset desctiption

List of every arrest in NYC going back to 2006 through the end of the previous calendar year. This is a breakdown of every arrest effected in NYC by the NYPD going back to 2006 through the end of the previous calendar year. This data is manually extracted every quarter and reviewed by the Office of Management Analysis and Planning before being posted on the NYPD website. Each record represents an arrest effected in NYC by the NYPD and includes information about the type of crime, the location and time of enforcement. In addition, information related to suspect demographics is also included. This data can be used by the public to explore the nature of police enforcement activity. Please refer to the attached data footnotes for additional information about this dataset. This dataset has about 4.8M rows and 18 colums. 

We will access it with via the Socrata API as shown below. The data shown below is from a subset of the NYPD data of year 2019. The full dataset is very large and we will use a downsampled version for our analysis. 

```{r}
## install.packages("RSocrata")
library("RSocrata")

app_token <- "Fm6ShrlqYtvnNx0IB9N0EyrfT"

year_to_date <- "https://data.cityofnewyork.us/resource/uip8-fykc.json"
nypd_fullset <- "https://data.cityofnewyork.us/resource/8h9b-rp9u.json"

nypd <- read.socrata(year_to_date, app_token = app_token)
```

```{r include=FALSE}
library(kableExtra)

showtable <- function(data, title="", nrows=10) {
  kable(head(data, nrows), caption = title) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), latex_options = "scale_down")
}
```

```{r}
showtable(nypd,"NYPD Data", 10)
```

### Civilian Complaint Review Board (CCRB)

List of complaints against New York City police officers alleging the use of excessive or unnecessary force, abuse of authority, discourtesy, or the use of offensive language.

[Civilian Complaint Review Board (CCRB) - Complaints Received](https://data.cityofnewyork.us/Public-Safety/Civilian-Complaint-Review-Board-CCRB-Complaints-Re/63nx-cpi9)  

#### Dataset description

The New York City Civilian Complaint Review Board (CCRB) is an independent agency. It is empowered to receive, investigate, mediate, hear, make findings, and recommend action on complaints against New York City police officers alleging the use of excessive or unnecessary force, abuse of authority, discourtesy, or the use of offensive language. The Boardâ€™s investigative staff, composed entirely of civilian employees, conducts investigations in an impartial fashion. The Board forwards its findings to the police commissioner. This dataset is about ~240K rows and 10 colums. 

## Exploratory Data Analysis

We will look at:  
- Trends in seasonality of arrests  
- Trends in types of arrests  
- Trends in location of arrests  
- Geographical distribution of arrests in NYC  
- Trends in types of complaints  
- Trends in reporting method of complaints  

## Data Transformation

Our two datasets share two main variables: arrest date and borough of incident. The date variable differs slightly between datasets. The NYPD Data is in the MM/DD/YYYY format and ranges from 01/01/2006 to 12/31/2018. The CCRB data only provides the year in the YYYY format ranging from 2000 to 2017. We will need to split the date variable in order join the datasets on the year.

In order to combine data from the two sources, we will need aggregate the variables by year for ease of comparison. 

## Data Analysis

We will try to build a model to predit crime rates and predict the subsequent effect of compliants filed against the NYPD. We will model this prediction using linear regression, etc. 

## Workflow scheme

The diagram below is a representation of our overall methodology. Two factors were determinant in how the team approached this project;

* Overall duration of project: 3 Weeks
* How the work would flow downstream
* Satisfying and cover all the requirements.

```{r}
library(DiagrammeR)
DiagrammeR::grViz("digraph {

graph [layout = dot, rankdir = LR]

# define the global styles of the nodes. We can override these in box if we wish
node [shape = rectangle, style = filled, fillcolor = Linen]

data1 [label = 'NYPD dataset', shape = folder, fillcolor = cyan]
data2 [label = 'CCRB dataset', shape = folder, fillcolor = cyan]
process [label =  'Process \n Data', fillcolor = green]
tidy [label =  'Tidy \n Data', fillcolor = green]
statistical [label = 'Statistical \n Analysis', fillcolor = orange]
results [label= 'Results', shape = oval, fillcolor = honeydew]
conclusion [label= 'Conclusion', fillcolor = powderBlue]

# edge definitions with the node IDs
{data1 data2}  -> process -> tidy -> statistical -> {results conclusion}
}")

```

So we set a preliminary timeframe plan with the required tasks to keep them team on track and easy for us to track  progress. 

```{r}
DiagrammeR::mermaid("
gantt
        dateFormat  YYYY-MM-DD
        title Flowchart of the work flow estimated for the final project

        section Data acquisition
        Brain storm ideas            :done,    des1, 2014-01-06,2014-01-08
        Data collecting          :done,    des2, 2014-01-07, 2d
        Proposal draft               :done,  des3, 2014-01-07, 2d

        section Data processing
        Database API fetching     :active, des4, after des3, 1d
        Clean-up          :active, des5, after des4, 3d
        Transform             :      des6, after des5, 3d
        Exploratory analysis        :    des7, after des6, 3d

        section Statistical analysis
        Regression model               :    a1, after des6, 4d
        Visualization                  :   a2, after des7  , 2d

        section Documentation
        final submission               :doc1, after a2, 3d
        presentation          : after doc1, 2d
")
```

